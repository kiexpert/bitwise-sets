<!DOCTYPE html><html lang="en"><head>
<meta charset="UTF-8"><meta name="viewport"content="width=device-width,initial-scale=1.0">
<title>WkJSON Formatter</title>
<style>
body{margin:0;padding:0;font-family:Consolas,monospace;background:#111;color:#eee;display:flex;flex-direction:column;height:100vh}
header{padding:10px 16px;background:#222;font-size:18px;font-weight:bold;flex:none;white-space:nowrap}
header span{color:#00eaff}
.controls{position:fixed;bottom:0;left:0;width:100%;background:#222;padding:6px 12px;
display:flex;justify-content:flex-end;gap:6px;border-top:1px solid #444;z-index:10}
section{flex:1;display:flex;gap:4px;padding:4px 4px 50px 4px;overflow:hidden}
textarea{flex:1;background:#000;border:1px solid #333;color:#0f0;font-size:13px;
resize:none;padding:6px;box-sizing:border-box;overflow:auto;line-height:1.3}
#output{white-space:pre}
.msg{position:fixed;bottom:42px;left:0;width:100%;background:#ff880033;color:#ffb347;
padding:4px 10px;font-size:12px;border-top:1px solid #ffb347;text-align:center;display:none;z-index:20}
.key{color:#8cf}.num{color:#ffb347}.str{color:#c5e1ff}.bracket{color:#aaa}
.ln{color:#666;user-select:none;margin-right:8px}
pre{margin:0;white-space:pre}
button{padding:6px 10px;background:#444;border:none;color:#eee;
cursor:pointer;font-size:12px;border-radius:3px}
button:hover{background:#555}
</style>
</head><body>
<header>WkJSON — Well Keyed JSON Formatter <span>by Will Kim & DeepToHyde</span></header>

<div class="msg" id="msg"></div>

<div class="controls">
<button id="convertBtn">Convert</button>
<button id="copyIn">Copy IN</button>
<button id="copyOut">Copy OUT</button>
<button id="loadSample">Sample</button>
</div>

<section>
<textarea id="input" wrap="soft" placeholder="Paste JSON here"></textarea>
<textarea id="output" wrap="off" placeholder="Formatted JSON appears here"></textarea>
</section>

<script>
const input=document.getElementById("input"),output=document.getElementById("output")
const convertBtn=document.getElementById("convertBtn")
const copyIn=document.getElementById("copyIn"),copyOut=document.getElementById("copyOut"),loadSample=document.getElementById("loadSample")
const msg=document.getElementById("msg")

function wkDump(obj){
let s=JSON.stringify(obj,null).replace(/,|:/g,m=>m+" ")
s=s.replace(/(, |{ )\s*"(?=[^0-9-])/,m=>"\n"+m)
s=s.replace(/}[\n]?, "(?=[^0-9-])/,m=>"\n},\"")
return s}

function highlight(s){
return s
.replace(/"(.*?)":/g,'<span class="key">"$1"</span>:')
.replace(/\b(-?\d+(\.\d+)?)\b/g,'<span class="num">$1</span>')
.replace(/"(.*?)"/g,'<span class="str">"$1"</span>')
.replace(/[\{\}\[\]]/g,m=>'<span class="bracket">'+m+'</span>')
}

function addLineNumbers(s){
return s.split("\n").map((l,i)=>`<span class="ln">${String(i+1).padStart(3," ")}</span>${l}`).join("\n")
}

function convert(){
try{
const obj=JSON.parse(input.value)
let s=wkDump(obj)
s=s.split("\n").map(highlight).join("\n")
output.innerHTML=addLineNumbers(s)
}catch(e){output.innerHTML="❌ JSON Parse Error: "+e.message}
}

copyIn.onclick=()=>navigator.clipboard.writeText(input.value)
copyOut.onclick=()=>navigator.clipboard.writeText(output.innerText)
loadSample.onclick=()=>fetch("default.json?v="+Date.now())
.then(r=>r.text()).then(t=>{input.value=t;convert()})

let autoTimer=null,autoCount=0
input.addEventListener('paste',()=>{
let size=input.value.length
let sec=size>1_000_000?1:size>50_000?3:5
autoCount=sec
showMsg(`Auto-Convert in ${autoCount}… (or click Convert)`)
clearInterval(autoTimer)
autoTimer=setInterval(()=>{
autoCount--
if(autoCount<=0){clearInterval(autoTimer);hideMsg();convert()}
else showMsg(`Auto-Convert in ${autoCount}… (or click Convert)`)
},1000)
})

convertBtn.onclick=()=>{
clearInterval(autoTimer)
hideMsg()
convert()
}

function showMsg(t){msg.innerText=t;msg.style.display="block"}
function hideMsg(){msg.style.display="none"}

window.addEventListener('load',()=>setTimeout(()=>loadSample.click(),1000))
</script>

</body></html>

